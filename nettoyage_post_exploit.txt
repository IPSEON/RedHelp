# Nettoyage post-exploitation - Effacer ses traces proprement

🎯 Objectif : Ne pas laisser de traces de ton passage après un accès système.
💡 Attention : à utiliser uniquement dans un contexte autorisé (CTF, test pro avec accord écrit).

---

🔹 1. Nettoyer l’historique de commandes Bash

Les utilisateurs Linux laissent des traces dans :
- ~/.bash_history
- HISTFILE (variable d’environnement)

➤ Commandes à exécuter :

    history -c                     # vide l'historique actuel
    unset HISTFILE                # désactive l'historique temporairement
    rm ~/.bash_history            # supprime le fichier
    echo "" > ~/.bash_history     # vide sans supprimer

---

🔹 2. Supprimer les fichiers temporaires utilisés

Supprime les payloads, reverse shells, outils transférés :

    rm /tmp/reverse.sh
    rm /home/victim/exploit.py
    rm -rf /var/tmp/lolbin.sh

Utilise `shred` si tu veux écraser les données (plus discret) :

    shred -u mon_fichier_secret.txt

---

🔹 3. Effacer les journaux systèmes (⚠️ Risqué !)

Certaines actions sont enregistrées dans `/var/log` :
- auth.log : connexions SSH, sudo
- bash.log, syslog, messages…

⚠️ Cela peut casser des services ou alerter des systèmes de détection.

    echo > /var/log/auth.log
    echo > /var/log/syslog
    > /var/log/messages

Astuce plus soft :
    find /var/log -type f -exec truncate -s 0 {} \;

---

🔹 4. Supprimer des utilisateurs ajoutés (si escalade)

    userdel -r hacker
    groupdel backdoor_group

---

🔹 5. Nettoyage de cron / persistence

Vérifie que tu n’as rien laissé dans :
    crontab -l
    ls -la /etc/cron*

Et supprime ce que tu as ajouté :
    crontab -r

---

🔹 6. Effacer les accès réseau / tunnels

    killall ssh
    killall nc
    iptables -F            # (optionnel, à éviter en prod !)

---

🔹 7. Nettoyage Metasploit

Si tu as utilisé Meterpreter :
    clearev     # supprime les logs d’événements
    timestomp   # modifie les dates d’accès de fichier

---

🧠 BONNES PRATIQUES :

✅ Toujours vérifier ce que tu supprimes  
✅ Ne JAMAIS faire ça sur une machine sans autorisation  
✅ En CTF : nettoie tout avant de valider si requis  
✅ En entreprise : laisse les traces pour l’analyse (souvent demandé)

---

💬 Exemple final (en root ou sudo) :

```bash
history -c && unset HISTFILE
rm -rf /tmp/* /var/tmp/* ~/payloads/*
truncate -s 0 /var/log/*
